{
  "z_heights": {
    "mold_transfer_safe": {
      "description": "Clearance for mold transfer, scale, and global readiness. Gantry will not collide with trickler, but tool can.",
      "z_coordinate": 95.0
    }
  },
  "coordinate_tolerance": {
    "x": 0.2,
    "y": 0.2,
    "z": 0.2,
    "v": 0.2,
    "description": "Maximum allowed deviation (in mm or degrees) from expected coordinates"
  },
  "positions": [
    {
      "id": "global_ready",
      "type": "GLOBAL_READY",
      "description": "Global clearance position safe for most traversals.",
      "allows_tool_engagement": false,
      "coordinates": {
        "x": 150.0,
        "y": 80.0,
        "z": "USE_Z_HEIGHT_POLICY",
        "v": 30.0
      },
      "allowed_origins": [
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY",
        "MOLD_READY"
      ],
      "allowed_destinations": [
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY",
        "MOLD_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      }
    },
    {
      "id": "scale_ready",
      "type": "SCALE_READY",
      "description": "Ready position above the scale for mold handling.",
      "allows_tool_engagement": true,
      "coordinates": {
        "x": 150.0,
        "y": 80.0,
        "z": "USE_Z_HEIGHT_POLICY",
        "v": 30.0
      },
      "allowed_origins": [
        "SCALE_READY",
        "GLOBAL_READY",
        "MOLD_READY",
        "scale_active"
      ],
      "allowed_destinations": [
        "SCALE_READY",
        "GLOBAL_READY",
        "MOLD_READY",
        "scale_active"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "mold_without_top_piston"
      },
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator",
          "payload_state": "mold_without_top_piston"
        },
        "allowed_actions": []
      }
    },
    {
      "id": "scale_active",
      "type": "SCALE_READY",
      "description": "Active position with mold physically on the scale, under the trickler.",
      "allows_tool_engagement": true,
      "coordinates": {
        "x": 150.0,
        "y": 143.0,
        "z": 28.0,
        "v": 67.0
      },
      "allowed_origins": [
        "SCALE_READY"
      ],
      "allowed_destinations": [
        "SCALE_READY"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "mold_without_top_piston",
        "mold_on_scale": true
      },
      "z_height_policy": {
        "allowed": []
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator",
          "payload_state": "mold_without_top_piston",
          "mold_on_scale": true
        },
        "allowed_actions": [
          "trickler_dispense"
        ]
      }
    },
    {
      "id": "dispenser_ready_0",
      "type": "DISPENSER_READY",
      "description": "Ready position for dispenser station 0.",
      "allows_tool_engagement": true,
      "coordinates": {
        "x": 298.0,
        "y": 140.0,
        "z": 95.0,
        "v": 34.0
      },
      "allowed_origins": [
        "DISPENSER_READY",
        "GLOBAL_READY",
        "SCALE_READY"
      ],
      "allowed_destinations": [
        "DISPENSER_READY",
        "GLOBAL_READY",
        "SCALE_READY"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "mold_without_top_piston"
      },
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ],
        "required": "mold_transfer_safe"
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator",
          "payload_state": "mold_without_top_piston"
        }
      }
    },
    {
      "id": "dispenser_ready_1",
      "type": "DISPENSER_READY",
      "description": "Ready position for dispenser station 1.",
      "allows_tool_engagement": true,
      "coordinates": {
        "x": 362.5,
        "y": 337.0,
        "z": "USE_Z_HEIGHT_POLICY",
        "v": 30.0
      },
      "allowed_origins": [
        "DISPENSER_READY",
        "GLOBAL_READY",
        "SCALE_READY"
      ],
      "allowed_destinations": [
        "DISPENSER_READY",
        "GLOBAL_READY",
        "SCALE_READY"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "mold_without_top_piston"
      },
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ],
        "required": "mold_transfer_safe"
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator",
          "payload_state": "mold_without_top_piston"
        }
      }
    },
    {
      "id": "mold_ready_0",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 0.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_1",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 1.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_2",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 2.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_3",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 3.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_4",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 4.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_5",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 5.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_6",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 6.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_7",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 7.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_8",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 8.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_9",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 9.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_10",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 10.",
      "coordinates": {
        "x": 150.0,
        "y": 40.0,
        "z": "USE_Z_HEIGHT_POLICY",
        "v": 30.0
      },
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_11",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 11.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_12",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 12.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_13",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 13.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_14",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 14.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    },
    {
      "id": "mold_ready_15",
      "type": "MOLD_READY",
      "description": "Ready position for mold slot 15.",
      "allows_tool_engagement": true,
      "allowed_origins": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "allowed_destinations": [
        "MOLD_READY",
        "GLOBAL_READY",
        "SCALE_READY",
        "DISPENSER_READY"
      ],
      "requirements": {},
      "z_height_policy": {
        "allowed": [
          "mold_transfer_safe"
        ]
      },
      "engagement": {
        "requirements": {
          "active_tool_id": "manipulator"
        }
      }
    }
  ],
  "actions": [
    {
      "id": "trickler_dispense",
      "description": "Dispense from the trickler while holding a mold without its top piston at the scale.",
      "requires_tool_engaged": true,
      "required_tool_id": "manipulator",
      "position_scope": [
        "scale_active"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "mold_without_top_piston"
      }
    },
    {
      "id": "pick_up_mold",
      "description": "Pick up a mold from a mold slot.",
      "blocked_when_engaged": true,
      "required_tool_id": "manipulator",
      "position_scope": [
        "mold_ready_0",
        "mold_ready_1",
        "mold_ready_2",
        "mold_ready_3",
        "mold_ready_4",
        "mold_ready_5",
        "mold_ready_6",
        "mold_ready_7",
        "mold_ready_8",
        "mold_ready_9",
        "mold_ready_10",
        "mold_ready_11",
        "mold_ready_12",
        "mold_ready_13",
        "mold_ready_14",
        "mold_ready_15"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "empty"
      }
    },
    {
      "id": "put_down_mold",
      "description": "Place a mold into a mold slot.",
      "blocked_when_engaged": true,
      "required_tool_id": "manipulator",
      "position_scope": [
        "mold_ready_0",
        "mold_ready_1",
        "mold_ready_2",
        "mold_ready_3",
        "mold_ready_4",
        "mold_ready_5",
        "mold_ready_6",
        "mold_ready_7",
        "mold_ready_8",
        "mold_ready_9",
        "mold_ready_10",
        "mold_ready_11",
        "mold_ready_12",
        "mold_ready_13",
        "mold_ready_14",
        "mold_ready_15"
      ],
      "requirements": {
        "active_tool_id": "manipulator"
      },
      "excludes": {
        "payload_state": "empty"
      }
    },
    {
      "id": "retrieve_piston",
      "description": "Retrieve a piston from the dispenser and insert into mold. Requires manipulator tool, mold without top piston, and must start from the corresponding dispenser ready position.",
      "blocked_when_engaged": true,
      "required_tool_id": "manipulator",
      "position_scope": [
        "dispenser_ready_0",
        "dispenser_ready_1"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "mold_without_top_piston"
      }
    },
    {
      "id": "tamp_mold",
      "description": "Tamp the contents of a mold.",
      "blocked_when_engaged": true,
      "required_tool_id": "manipulator",
      "position_scope": [
        "mold_ready_0",
        "mold_ready_1",
        "mold_ready_2",
        "mold_ready_3",
        "mold_ready_4",
        "mold_ready_5",
        "mold_ready_6",
        "mold_ready_7",
        "mold_ready_8",
        "mold_ready_9",
        "mold_ready_10",
        "mold_ready_11",
        "mold_ready_12",
        "mold_ready_13",
        "mold_ready_14",
        "mold_ready_15",
        "scale_ready"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "mold_without_top_piston"
      }
    },
    {
      "id": "home_all",
      "description": "Home all axes (X, Y, Z, U). Can be conducted from any position (typical), but requires no tool picked up and no mold. Returns machine to global_ready position.",
      "blocked_when_engaged": true,
      "position_scope": [],
      "requirements": {
        "payload_state": "empty"
      },
      "excludes": {
        "active_tool_id": "manipulator"
      }
    },
    {
      "id": "home_manipulator",
      "description": "Home the manipulator axis (V). Requires no mold picked up.",
      "blocked_when_engaged": true,
      "position_scope": [],
      "requirements": {
        "payload_state": "empty"
      }
    },
    {
      "id": "home_trickler",
      "description": "Home the trickler axis (W). Can be homed at any time with no requirements.",
      "blocked_when_engaged": false,
      "position_scope": [],
      "requirements": {}
    },
    {
      "id": "pickup_tool",
      "description": "Pick up the manipulator tool and return to global_ready position. Valid from mold_ready or global_ready positions. Requires no tool already picked up and mold_transfer_safe z_height.",
      "blocked_when_engaged": true,
      "position_scope": [
        "GLOBAL_READY"
      ],
      "requirements": {
        "payload_state": "empty",
        "z_height_id": "mold_transfer_safe"
      },
      "excludes": {
        "active_tool_id": "manipulator"
      }
    },
    {
      "id": "park_tool",
      "description": "Park the manipulator tool and return to global_ready position. Valid from global_ready position. Requires manipulator tool to be active.",
      "blocked_when_engaged": true,
      "required_tool_id": "manipulator",
      "position_scope": [
        "GLOBAL_READY"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "empty",
        "z_height_id": "mold_transfer_safe"
      }
    },
    {
      "id": "place_mold_on_scale",
      "description": "Place a held mold onto the scale. Must be at scale_ready position with manipulator tool holding a mold without top piston.",
      "blocked_when_engaged": true,
      "required_tool_id": "manipulator",
      "position_scope": [
        "scale_ready"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "mold_without_top_piston"
      }
    },
    {
      "id": "pick_mold_from_scale",
      "description": "Pick up a mold from the scale. Must be at scale_active position with manipulator tool engaged and mold on scale.",
      "requires_tool_engaged": true,
      "required_tool_id": "manipulator",
      "position_scope": [
        "scale_active"
      ],
      "requirements": {
        "active_tool_id": "manipulator",
        "payload_state": "mold_without_top_piston",
        "mold_on_scale": true
      }
    }
  ]
}
